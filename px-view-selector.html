<link rel="import" href="../polymer/polymer.html"/>


<!--
Element which displays a dropdown of views and returns the url for the selected view.

##### Usage

    <px-view-selector views="{{...}}" selecteddeckurl="{{...}}"></px-view-selector>

@demo demo.html
-->
<dom-module id="px-view-selector">
    <link rel="import" type="css" href="css/px-view-selector.css"/>
    <template>
        <div class="dropdown-text" on-click="_toggleDropdown" hidden="{{!isViews}}">
            <span class="epsilon">{{selectedView.name}}</span>
            <i class="fa fa-caret-down"></i>
        </div>
        <ul id="dropdown" class="dropdown-menu list-bare" hidden>
            <template is="dom-repeat" items="{{views}}" as="view">
                <li on-click="_selectView">
                    <div>{{view.name}}</div>
                </li>
            </template>
        </ul>            
    </template>
</dom-module>

<script>
    Polymer({

        is: 'px-view-selector',

        properties: {

            /**
             * List of views to display.
             * 
             *      [
             *          {name: 'First Deck', url: '/deck1'},
             *          {name: 'Second Deck', url: '/deck2'},
             *          {name: 'Third Deck', url: '/deck3'}                    
             *      ]
             *
             */
            views: {
                type: Array,
                observer: '_setViews'
            },

            /**
             * Url of the selected view.
             */
            selecteddeckurl: {
                type: String,
                notify: true,
                reflectToAttribute: true
            },

            /**
             * @private
             */
             isViews: {
                type: Boolean,
                value: false
             }
        },

        observers: ['_broadcastSelectedViewUrl(selectedView)'],

        _setViews: function() {
            this.set('isViews', this.views && this.views.length > 0);

            var selectedView = null;

            if(this.isViews) { 
                selectedView = this.views[0];
            }
            
            this.set('selectedView', selectedView);
        },

        _toggleDropdown: function() {
            this.$.dropdown.hidden = !this.$.dropdown.hidden;
        },

        _broadcastSelectedViewUrl: function() {
            if(this.selectedView) {
                this.set('selecteddeckurl', this.selectedView.url);                
            }
        },

        _selectView: function(e) {
            this.set('selectedView', e.model.view);
            this.$.dropdown.hidden = true;
        }

    });
</script>
